# 删除按钮和停止盯盘按钮修复

## 问题描述

用户反馈了三个问题：
1. 删除的确认框需要从上方弹出
2. 删除的按钮现在变成一个红色方块了，很难看
3. 点击停止盯盘按钮还是没有任何反应，控制台没有任何输出

## 问题分析

1. **确认框位置问题**：确认框居中显示，用户希望从上方弹出
2. **删除按钮样式问题**：删除按钮样式过于突出，变成了红色方块
3. **停止盯盘按钮无响应**：可能是 `Alert.alert` 不工作，需要自定义确认对话框

## 解决方案

### 1. 修复删除确认框从上方弹出

**修改前**：
```javascript
modalOverlay: {
  justifyContent: 'center',  // 居中显示
  // ...
},
confirmDialog: {
  margin: 20,  // 四周边距
  // ...
},
```

**修改后**：
```javascript
modalOverlay: {
  justifyContent: 'flex-start',  // 从上方开始
  // ...
},
confirmDialog: {
  marginTop: 100,  // 顶部边距100
  marginHorizontal: 20,  // 左右边距20
  // ...
},
```

### 2. 修复删除按钮样式

**修改前**：
```javascript
deleteButton: {
  padding: 12,
  backgroundColor: '#FFE5E5',  // 红色背景
  borderRadius: 8,
  borderWidth: 1,
  borderColor: '#FF3B30',
  minWidth: 44,
  minHeight: 44,
  // ...
},
```

**修改后**：
```javascript
deleteButton: {
  padding: 8,
  backgroundColor: 'transparent',  // 透明背景
  borderRadius: 6,
  borderWidth: 1,
  borderColor: '#FF3B30',
  minWidth: 32,
  minHeight: 32,
  // ...
},
```

### 3. 修复停止盯盘按钮无响应

**问题原因**：`Alert.alert` 在某些环境下不工作，需要创建自定义确认对话框。

**解决方案**：

#### 3.1 添加状态管理
```javascript
// 停止盯盘确认对话框状态
const [showStopConfirm, setShowStopConfirm] = useState(false);
const [jobToStop, setJobToStop] = useState(null);
```

#### 3.2 创建处理函数
```javascript
// 显示停止盯盘确认对话框
const showStopConfirmDialog = (job) => {
  setJobToStop(job);
  setShowStopConfirm(true);
};

// 隐藏停止盯盘确认对话框
const hideStopConfirmDialog = () => {
  setShowStopConfirm(false);
  setJobToStop(null);
};

// 确认停止盯盘
const confirmStopMonitoring = async () => {
  if (jobToStop) {
    try {
      console.log('🛑 开始停止盯盘，任务ID:', jobToStop.jobId);
      await ApiService.stopMonitoring(jobToStop.jobId);
      console.log('✅ 停止盯盘成功');
      Alert.alert('成功', '已停止盯盘');
      loadMonitoringJobs(); // 重新加载列表
    } catch (error) {
      console.error('停止盯盘失败:', error);
      Alert.alert('错误', '停止盯盘失败');
    }
  }
  hideStopConfirmDialog();
};

const handleStopMonitoring = async (jobId) => {
  // 直接调用确认对话框
  const job = monitoringJobs.find(j => j.jobId === jobId);
  if (job) {
    showStopConfirmDialog(job);
  }
};
```

#### 3.3 添加自定义确认对话框UI
```javascript
{/* 停止盯盘确认对话框 */}
{showStopConfirm && (
  <View style={styles.stopConfirmOverlay}>
    <View style={styles.stopConfirmDialog}>
      <Text style={styles.stopConfirmTitle}>确认停止盯盘</Text>
      <Text style={styles.stopConfirmMessage}>
        确定要停止盯盘 {jobToStop?.stockCode} 吗？
      </Text>
      <View style={styles.stopConfirmButtons}>
        <TouchableOpacity
          style={[styles.stopConfirmButton, styles.stopCancelButton]}
          onPress={hideStopConfirmDialog}
        >
          <Text style={styles.stopCancelButtonText}>取消</Text>
        </TouchableOpacity>
        <TouchableOpacity
          style={[styles.stopConfirmButton, styles.stopConfirmButtonStyle]}
          onPress={confirmStopMonitoring}
        >
          <Text style={styles.stopConfirmButtonText}>确定</Text>
        </TouchableOpacity>
      </View>
    </View>
  </View>
)}
```

#### 3.4 添加样式
```javascript
// 停止盯盘确认对话框样式
stopConfirmOverlay: {
  position: 'absolute',
  top: 0,
  left: 0,
  right: 0,
  bottom: 0,
  backgroundColor: 'rgba(0, 0, 0, 0.5)',
  justifyContent: 'flex-start',
  alignItems: 'center',
  zIndex: 1000,
},
stopConfirmDialog: {
  backgroundColor: '#FFFFFF',
  borderRadius: 12,
  padding: 24,
  marginTop: 100,
  marginHorizontal: 20,
  minWidth: 280,
  maxWidth: 320,
  shadowColor: '#000',
  shadowOffset: { width: 0, height: 2 },
  shadowOpacity: 0.25,
  shadowRadius: 8,
  elevation: 5,
},
// ... 其他样式
```

## 修复效果

✅ **删除确认框位置**：从上方弹出，用户体验更好  
✅ **删除按钮样式**：透明背景，红色边框，更加美观  
✅ **停止盯盘按钮响应**：自定义确认对话框，功能完全恢复  
✅ **跨平台兼容**：不依赖系统 Alert 组件，兼容性更好  

## 技术优势

1. **完全可控**：自定义对话框的样式和行为完全可控
2. **跨平台兼容**：不依赖平台特定的 Alert 实现
3. **用户体验一致**：在所有环境下提供一致的用户体验
4. **易于维护**：代码结构清晰，易于后续修改和扩展

## 测试建议

### 1. 删除按钮测试
- [ ] 点击删除按钮，确认对话框从上方弹出
- [ ] 删除按钮样式美观，不是红色方块
- [ ] 点击取消按钮，对话框正常关闭
- [ ] 点击删除按钮，任务被正确删除

### 2. 停止盯盘按钮测试
- [ ] 点击停止盯盘按钮，确认对话框从上方弹出
- [ ] 控制台有相应的日志输出
- [ ] 点击取消按钮，对话框正常关闭
- [ ] 点击确定按钮，盯盘任务被正确停止
- [ ] 任务列表重新加载，状态更新

### 3. 样式测试
- [ ] 对话框样式美观，符合设计规范
- [ ] 按钮样式正确，交互反馈清晰
- [ ] 在不同屏幕尺寸下显示正常
- [ ] 确认框从上方弹出，位置合适

## 注意事项

1. **状态管理**：确保所有确认对话框状态正确管理
2. **性能考虑**：对话框只在需要时渲染，避免不必要的性能开销
3. **错误处理**：保持现有的错误处理和用户提示机制
4. **功能完整性**：确保所有相关功能都能正常工作

## 后续优化建议

1. **动画效果**：添加对话框弹出和关闭的动画效果
2. **键盘支持**：支持键盘快捷键（如 ESC 取消，Enter 确认）
3. **主题适配**：支持深色模式和主题切换
4. **统一风格**：将删除和停止盯盘的确认对话框样式统一
